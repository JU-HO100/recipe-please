CREATE OR REPLACE PROCEDURE TEAM_NULLPOINT.proc_board_delete
(
   p_board_no IN menu.menucd%TYPE,
   p_user_id  IN member.m_id%TYPE,
   msg OUT varchar2
)
IS
    cnt number;
    DeleteChecker number;           -- 여러가지 트랜잭션에 필요한 데이터들이 존재하는지 체크
    
    e_no_right  EXCEPTION;
    
BEGIN       
    
    SELECT count(*) INTO cnt FROM recipe WHERE m_id = p_user_id AND menucd=p_board_no;
    
    IF(cnt>0) THEN
    
        SELECT count(*) into DeleteChecker FROM popular_recipe WHERE menucd = p_board_no; -- 인기레시피에 등록되어있는지 체크
    
        IF (DeleteChecker>0) THEN
        
            DELETE FROM popular_recipe WHERE menucd = p_board_no;                      --인기레시피에 등록되어있는 것부터 삭제
        
        END IF;
        
        
        DeleteChecker:=0;   -- 체커 초기화
        SELECT count(*) into DeleteChecker FROM likes WHERE menucd=p_board_no; --글에 등록되어있는 좋아요가 있나 체크
        
        IF(DeleteChecker>0) THEN
        
            DELETE FROM LIKES  WHERE menucd = p_board_no;   -- 해당 게시물의 모든 좋아요 삭제
        
        END IF;
        
        
        DeleteChecker:=0;   -- 체커 초기화
        SELECT count(*) into DeleteChecker FROM likes WHERE menucd=p_board_no;
        
        IF(DeleteChecker>0) THEN
            
            DELETE FROM RECIPE_WEIGH WHERE menucd = p_board_no; --해당 게시물의 모든 재료,  계량 삭제
        
        END IF;
        
        DeleteChecker:=0;   -- 체커 초기화
        SELECT count(*) into DeleteChecker FROM HASHTAG WHERE menucd=p_board_no;
        
        IF(DeleteChecker>0) THEN
        
            DELETE FROM HASHTAG  WHERE menucd = p_board_no;
        
        END IF;
        
        DeleteChecker:=0;   -- 체커 초기화
        SELECT count(*) into DeleteChecker FROM RECIPE WHERE menucd=p_board_no;
        
        IF(DeleteChecker>0) THEN
        
            DELETE FROM RECIPE   WHERE menucd = p_board_no AND m_id = p_user_id;
        
        END IF;
        
        DeleteChecker:=0;   -- 체커 초기화
        SELECT count(*) into DeleteChecker FROM MENU  WHERE menucd=p_board_no;
        
        IF(DeleteChecker>0) THEN
        
            DELETE FROM MENU  WHERE menucd = p_board_no;
        
        END IF;
        
        commit;
        msg:='정상적으로 삭제처리 되었습니다';
        
        
    ELSE
        raise e_no_right;
    
    END IF;
    
    
    EXCEPTION
        WHEN e_no_right THEN
            msg:='권한이 없습니다';
            rollback;
            return; 
END;
/
